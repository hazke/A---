# 数据获取问题排查指南

## 常见错误

### 错误1: Connection aborted / RemoteDisconnected

**错误信息：** `Connection aborted. RemoteDisconnected('Remote end closed connection without response')`

**原因：**
- AKShare API 服务器连接不稳定
- 请求超时
- 网络连接问题
- 请求过于频繁被限流

**解决方案：**
1. **已添加自动重试机制**（最多3次）
2. **检查网络连接**
3. **稍后重试**（避免频繁请求）
4. **使用历史日期**（未来日期无法获取数据）

### 错误2: 无法获取股票数据

**可能原因：**
1. **日期是未来日期** - 无法获取未来数据
2. **股票代码错误** - 代码不存在或已退市
3. **日期范围内无数据** - 该时间段股票停牌或未上市
4. **网络连接问题** - 见错误1

**解决方案：**
1. 使用历史日期（例如：2024-01-01 到 2024-12-31）
2. 验证股票代码是否正确
3. 检查股票在该时间段是否正常交易
4. 查看后端日志获取详细错误信息

### 错误3: 数据格式错误

**原因：** AKShare API 返回的列名可能变化

**解决方案：** 已添加列名自动匹配机制

## 推荐设置

### 回测日期设置

- ✅ **推荐日期范围：**
  - 开始日期：`2024-01-01` 或更早
  - 结束日期：`2024-12-31` 或当前日期之前

- ❌ **避免使用：**
  - 未来日期（无法获取数据）
  - 太近的日期（可能数据未更新）

### 股票代码格式

- ✅ **正确格式：** `000001`, `600000`, `002054`
- ✅ **支持格式：** `000001.SZ`, `600000.SH`（会自动处理）

### 网络问题处理

如果遇到连接问题：
1. 等待几秒后重试（系统会自动重试）
2. 检查网络连接
3. 如果持续失败，可能是 AKShare 服务器问题，稍后再试

## 查看详细日志

### Docker 环境

```bash
# 查看后端日志
docker-compose logs backend | grep AKShare

# 实时查看日志
docker-compose logs -f backend
```

### 本地环境

查看运行 `start_backend.py` 的终端输出，会显示：
```
[AKShare] 获取股票数据: 002054, 日期范围: 20240201 - 20240207
[AKShare] 成功获取 X 条数据
```

## 测试数据获取

### 测试股票代码

推荐使用这些常见股票代码进行测试：
- `000001` - 平安银行
- `600000` - 浦发银行
- `000002` - 万科A
- `600519` - 贵州茅台

### 测试日期

使用这些日期范围测试：
- `2024-01-01` 到 `2024-01-31`（一个月）
- `2023-01-01` 到 `2023-12-31`（一年）

## 如果仍然失败

1. **检查后端日志** - 查看详细错误信息
2. **验证股票代码** - 确认代码存在且有效
3. **使用历史日期** - 避免使用未来日期
4. **检查网络** - 确保可以访问互联网
5. **稍后重试** - AKShare 服务器可能暂时不可用

